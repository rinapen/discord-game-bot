STAKE_MINES_MULTIPLIERS = {
    1: [1.0300, 1.0800, 1.1200, 1.1800, 1.2400, 1.3000, 1.3700, 1.4600, 1.5500, 1.6500, 1.7700, 1.9000, 2.0600, 2.2500, 2.4700, 2.7500, 3.0900, 3.5400, 4.1200, 4.9500, 6.1900, 8.2500, 12.3800, 24.7500],
    2: [1.0800, 1.1700, 1.2900, 1.4100, 1.5600, 1.7400, 1.6400, 2.1800, 2.4700, 2.8300, 3.2600, 3.8100, 4.5000, 5.4000, 6.6000, 8.2500, 10.6100, 14.1400, 19.8000, 29.7000, 49.5000, 99.0000, 297.0000],
    3: [1.1200, 1.2900, 1.4800, 1.7100, 2.0000, 2.3500, 2.7900, 3.3500, 4.0700, 5.0000, 6.2600, 7.9600, 10.3500, 13.8000, 18.9700, 27.1100, 40.6600, 65.0600, 113.8500, 227.7000, 569.2500, 2277.0000],
    4: [1.1800, 1.4100, 1.7100, 2.0900, 2.5800, 3.2300, 4.0900, 5.2600, 6.8800, 9.1700, 12.5100, 17.5200, 25.3000, 37.9500, 59.6400, 99.3900, 178.9100, 357.8100, 834.9000, 2504.7000, 12523.5000],
    5: [1.2400, 1.5600, 2.0000, 2.5800, 3.3900, 4.5200, 6.1400, 8.5000, 12.0400, 17.5200, 26.2700, 40.8700, 66.4100, 113.8500, 208.7200, 417.4500, 939.2600, 2504.7000, 8766.4500, 52598.7000],
    6: [1.3000, 1.7400, 2.3500, 3.2300, 4.5200, 6.4600, 9.4400, 14.1700, 21.8900, 35.0300, 58.3800, 102.1700, 189.7500, 379.5000, 834.9000, 2087.2500, 6261.7500, 25047.0000, 175329.0000],
    7: [1.3700, 1.9400, 2.7900, 4.0900, 6.1400, 9.4400, 14.9500, 24.4700, 41.6000, 73.9500, 138.6600, 277.3300, 600.8700, 1442.1000, 3965.7700, 13219.2500, 59486.0000, 475893.0000],
    8: [1.4600, 2.1800, 3.3500, 5.2600, 8.5000, 14.1700, 24.4700, 44.0500, 83.2000, 166.4000, 356.5600, 831.9800, 2163.1500, 6489.4500, 23794.6500, 118973.0000, 1070759.2500],
    9: [1.5500, 2.4700, 4.0700, 6.8800, 12.0400, 21.8900, 41.6000, 83.2000, 176.8000, 404.1000, 1010.2600, 2828.7300, 9193.3900, 36773.5500, 202254.5200, 2022545.2500],
    10: [1.6500, 2.8300, 5.0000, 9.1700, 17.5200, 35.0300, 73.9500, 166.4000, 404.1000, 1077.6100, 3232.8400, 11314.9400, 49031.4000, 294188.4000, 3236072.4000],
    11: [1.7700, 3.2600, 6.2600, 12.5100, 26.2700, 58.3800, 138.6600, 356.5600, 1010.2600, 3232.8400, 12123.1500, 56574.6900, 367735.5000, 4412826.0000],
    12: [1.9000, 3.8100, 7.9600, 17.5200, 40.8700, 102.1700, 277.3300, 831.9800, 2828.7300, 11314.9400, 56574.6900, 396022.8500, 5148297.0000],
    13: [2.0600, 4.5000, 10.3500, 25.3000, 66.4100, 189.7500, 600.8700, 2163.1500, 9193.3900, 49031.4000, 367735.5000, 5148297.0000],
    14: [2.2500, 5.4000, 13.8000, 37.9500, 113.8500, 379.5000, 1442.1000, 6489.4500, 36773.5500, 294188.4000, 4412826.0000],
    15: [2.4700, 6.6000, 18.9700, 59.6400, 208.7200, 834.9000, 3965.7700, 23794.6500, 202254.5200, 3236072.4000],
    16: [2.7500, 8.2500, 27.1100, 99.3900, 417.4500, 2087.2500, 13219.2500, 118973.2500, 2022545.2500],
    17: [3.0900, 10.6100, 40.6600, 178.9100, 939.2600, 6261.7500, 59486.6200, 1070759.2500],
    18: [3.5400, 14.1400, 65.0600, 357.8100, 2504.7000, 25047.0000, 475893.0000],
    19: [4.1200, 19.8000, 113.8500, 6489.4500, 9193.3900, 36773.5500, 202254.5200],
    20: [4.9500, 29.7000, 227.7000, 2504.7000, 52598.7000],
    21: [6.1900, 49.5000, 569.2500, 12523.5000],
    22: [8.2500, 99.0000, 2277.0000],
    23: [12.3700, 297.0000],
    24: [24.7500],
}

STAKE_MINES_MULTIPLIERS_REDUCED = {
    mines: [round(x * 0.95, 4) for x in ratios]
    for mines, ratios in STAKE_MINES_MULTIPLIERS.items()
}

def get_stake_multiplier(mine_count: int, revealed_count: int) -> float:
    """
    地雷数と開けた数から、低倍率版テーブルに基づく倍率を取得する。
    """
    table = STAKE_MINES_MULTIPLIERS_REDUCED.get(mine_count)
    if table and 0 <= revealed_count - 1 < len(table):
        return round(table[revealed_count - 1], 4)
    return 1.0


def get_safe_multiplier(mine_count, revealed_count, bet_amount, bank_balance, safety_margin=0.5):
    """倍率テーブルから倍率を取得し、銀行の残高に応じて制限"""
    table = STAKE_MINES_MULTIPLIERS.get(mine_count, [])
    if revealed_count <= 0 or revealed_count > len(table):
        return 1.0

    raw_multiplier = table[revealed_count - 1]
    max_safe_multiplier = (bank_balance * safety_margin) / bet_amount
    return min(raw_multiplier, max_safe_multiplier)